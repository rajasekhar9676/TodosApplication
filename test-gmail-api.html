<!DOCTYPE html>
<html>
<head>
    <title>Gmail API Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        textarea { width: 100%; height: 200px; font-family: monospace; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Gmail API Test Tool</h1>
    
    <div class="info status">
        <strong>üîç Testing Gmail API with your current credentials...</strong>
    </div>

    <button onclick="testGmailAPI()">üöÄ Test Gmail API</button>
    <button onclick="getNewRefreshToken()">üîë Get New Refresh Token</button>
    
    <div id="results"></div>
    
    <h3>üìã Manual Refresh Token Setup:</h3>
    <ol>
        <li><strong>Go to:</strong> <a href="https://developers.google.com/oauthplayground/" target="_blank">OAuth Playground</a></li>
        <li><strong>Settings (‚öôÔ∏è):</strong> Check "Use your own OAuth credentials"</li>
        <li><strong>Client ID:</strong> <span class="code">82418082461-pfjprkn3mu5c44mq0lioo0qti3s4v4eu.apps.googleusercontent.com</span></li>
        <li><strong>Client Secret:</strong> <span class="code">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</span></li>
        <li><strong>Scope:</strong> Select <span class="code">https://mail.google.com/</span></li>
        <li><strong>Authorize:</strong> Sign in with rajasekharm2268@gmail.com</li>
        <li><strong>Exchange:</strong> Get the complete refresh token</li>
    </ol>

    <h3>‚úèÔ∏è Update .env file:</h3>
    <div class="code">
        REACT_APP_GMAIL_REFRESH_TOKEN=[paste_complete_token_here]
    </div>

    <script>
        async function testGmailAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="info status">üîÑ Testing Gmail API...</div>';
            
            const credentials = {
                clientId: '82418082461-pfjprkn3mu5c44mq0lioo0qti3s4v4eu.apps.googleusercontent.com',
                clientSecret: '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',
                refreshToken: '1//0gTRK69r-QtVPCgYIARAAGBASNwF-L9IrqaHYMISFudSyDVEgZVzGjiX1K3vxEH7ElO2IX3K' // Current incomplete token
            };
            
            try {
                // Test getting access token
                const response = await fetch('https://oauth2.googleapis.com/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        client_id: credentials.clientId,
                        client_secret: credentials.clientSecret,
                        refresh_token: credentials.refreshToken,
                        grant_type: 'refresh_token',
                    }),
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultsDiv.innerHTML = `
                        <div class="success status">
                            ‚úÖ Gmail API working! Access token obtained successfully.
                            <br><strong>Token:</strong> ${data.access_token.substring(0, 20)}...
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="error status">
                            ‚ùå Gmail API Error: ${data.error || 'Unknown error'}
                            <br><strong>Description:</strong> ${data.error_description || 'No description'}
                            <br><strong>Solution:</strong> Your refresh token is incomplete or expired. Get a new one using the steps above.
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error status">
                        ‚ùå Network Error: ${error.message}
                        <br>Make sure you're connected to the internet.
                    </div>
                `;
            }
        }
        
        function getNewRefreshToken() {
            const url = 'https://accounts.google.com/o/oauth2/auth?' +
                'client_id=82418082461-pfjprkn3mu5c44mq0lioo0qti3s4v4eu.apps.googleusercontent.com&' +
                'redirect_uri=https://developers.google.com/oauthplayground&' +
                'scope=https://mail.google.com/&' +
                'response_type=code&' +
                'access_type=offline&' +
                'prompt=consent';
            
            window.open(url, '_blank');
            
            document.getElementById('results').innerHTML = `
                <div class="info status">
                    üîÑ OAuth window opened. After authorization:
                    <br>1. Copy the authorization code
                    <br>2. Go to OAuth Playground
                    <br>3. Exchange code for tokens
                    <br>4. Copy the refresh token to your .env file
                </div>
            `;
        }
    </script>
</body>
</html>

